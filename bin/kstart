#!/bin/bash

mkdir -p $HOME/netkit_temp/labs

echo -e "\033[0;33mRunning in Kubernetes mode. No terminals will open.\033[0m"

python $NETKIT_HOME/python/check.py "$PWD/" -f "$@"

export RC=$?
if [ "$RC" = "0" ]; then
    python $NETKIT_HOME/python/print_metadata.py "$PWD/" "$@"

    D=_deploy

    python $NETKIT_HOME/python/folder_hash.py "$PWD/" "$@" |
    while IFS=';' read -ra in; do (
		if [ -f "$HOME/netkit_temp/$in$D" ]; then
            echo -e "\033[0;33mLab already deployed. Exiting...\033[0m"
            exit 0
		else 
		    python $NETKIT_HOME/python/lstart.py "$PWD/" "$@" --k8s
		fi
    ); 
    done
else
    echo FAILED
fi
